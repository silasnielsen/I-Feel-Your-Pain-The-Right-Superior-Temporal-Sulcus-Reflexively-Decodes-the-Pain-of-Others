%% /fmri

function  write_out_masked_beta_surface( path_to_beta_file )
%This function takes the path to a beta map, masks it and writes out the
%resampled map in FreeSurfer surface space to the same folder where the original beta file is.
%
% The input should be the full name of the beta file as a string, e.g.,
% write_out_masked_beta_surface('/mnt/projects/empathy/fmri/analysis/newnew_firstlevel/newnew_onesample/con_0004/beta_0001.nii');

%First add the path to the kvl-library we need to fiddle with the images.
addpath('/mrhome/oulap/CodeForBasel/Source/GEMS2-compiled/bin/');

%Next read in the beta image
disp('Reading beta image.')
im_beta = kvlReadImage(path_to_beta_file);
beta_buffer = kvlGetImageBuffer(im_beta);

%Then read in the mask. Note: I assume that the mask is in the roi-folder, if it's ever moved this will throw an error.
disp('Reading mask image.')
im_mask = kvlReadImage('/mnt/projects/empathy/fmri/analysis/roi_masks/rctx_rh_S_temporal_sup.nii');
mask_buffer = kvlGetImageBuffer(im_mask);

%Now do the actual masking
disp('Masking.')
tmp = beta_buffer.*mask_buffer;

%Write out the temporary masked volume image (which is in the wrong space).
kvlSetImageBuffer(im_beta,tmp);
kvlWriteImage(im_beta,'tmp_masked_beta.nii');

%Next resample the temporary masked beta image to the same space as
%brain.nii. This call puts out an image called
%tmp_masked_beta_resampled.mgz
disp('Resampling.')
system(['kvlResample tmp_masked_beta.nii /mnt/projects/empathy/fmri/analysis/roi_masks/brain.nii']);

%Okay, now read in the resampled image (which is flipped due to some mgz
%and nifti differences).

im_beta_masked = kvlReadImage('tmp_masked_beta_resampled.mgz');
buffer_beta_masked = kvlGetImageBuffer(im_beta_masked);

%Read the header from the brain.nii image (which is in the space we want
%our masked beta to be in).

im_brain = kvlReadImage('/mnt/projects/empathy/fmri/analysis/roi_masks/brain.nii');

%Set the masked beta to the correct space
kvlSetImageBuffer(im_brain,buffer_beta_masked);

%Write it out
kvlWriteImage(im_brain,'tmp_beta_masked.nii');

%Figure out the path where to save the final result
[savePath, beta_name, ext_tmp] = fileparts(path_to_beta_file);
%Call the FreeSurfer function which interpolates the masked beta volume to
%the cortical surface
disp('Interpolating to surface.')
system(['mri_vol2surf --mov tmp_beta_masked.nii --reg ./transformation/brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o ' savePath '/' beta_name '_masked.mgh']);

%Clean up all the temporary files we wrote on the disk
delete 'tmp_masked_beta.nii' 'tmp_beta_masked.nii' 'tmp_masked_beta_resampled.mgz';

%And clear the memory
kvlClear;
disp('Done.')

end

%% /emp_calc/STS-mask
%% cd /home/silashn/emp_calc/STS-ImpExp_mask

%% create STS mask

% reslice (nearest & trilinear)
system(['mri_convert -rt nearest -rl brain.nii rctx_rh_S_temporal_sup.nii rctx_rh_S_temporal_sup_resliced_nearest.nii']); % reslice nearest
system(['mri_convert -rl brain.nii rctx_rh_S_temporal_sup.nii rctx_rh_S_temporal_sup_resliced_trilin.nii']); % reslice trilinear

% vol > 0
tmp = MRIread('rctx_rh_S_temporal_sup_resliced_trilin.nii');
vol = tmp.vol;
vol = single(vol>0);
tmp.vol = vol;
MRIwrite(tmp,'rctx_rh_S_temporal_sup_resliced_trilin_mask.nii','float');

% test STS mask (vol>0)
system(['mri_vol2surf --mov /home/silashn/emp_calc/STS-ImpExp_mask/rctx_rh_S_temporal_sup_resliced_trilin_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_rctx_rh_S_temporal_sup_resliced_trilin_mask.mgh']);

%% create ImpExpPain1 vol mask
system(['mri_convert -rt nearest -rl brain.nii ImpExpPain1.nii ImpExpPain1_resliced_nearest.nii']); % reslice nearest
system(['mri_convert -rl brain.nii ImpExpPain1.nii ImpExpPain1_resliced_trilin.nii']); % reslice trilinear

% vol > 0
clear all;
tmp = MRIread('ImpExpPain1_resliced_trilin.nii');
vol = tmp.vol;
vol = single(vol>0);
tmp.vol = vol;
MRIwrite(tmp,'ImpExpPain1_resliced_trilin_mask.nii','float');

% test ImpExpPain1 mask
system(['mri_vol2surf --mov ImpExpPain1_resliced_trilin_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_ImpExpPain1_resliced_trilin_mask.mgh']);

%% create ImpExpPain2 vol mask
system(['mri_convert -rt nearest -rl brain.nii ImpExpPain2.nii ImpExpPain2_resliced_nearest.nii']); % reslice nearest
system(['mri_convert -rl brain.nii ImpExpPain2.nii ImpExpPain2_resliced_trilin.nii']); % reslice trilinear
system(['mri_convert -rt cubic -rl brain.nii ImpExpPain2.nii ImpExpPain2_resliced_cubic.nii']); % reslice nearest

% trilin: vol > 0
clear all;
tmp = MRIread('ImpExpPain2_resliced_trilin.nii');
vol = tmp.vol;
vol = single(vol>0);
tmp.vol = vol;
MRIwrite(tmp,'ImpExpPain2_resliced_trilin_mask.nii','float');

% cubic: vol > 0
clear all;
tmp = MRIread('ImpExpPain2_resliced_cubic.nii');
vol = tmp.vol;
vol = single(vol>0);
tmp.vol = vol;
MRIwrite(tmp,'ImpExpPain2_resliced_cubic_mask.nii','float');

% test ImpExpPain1 mask
system(['mri_vol2surf --mov ImpExpPain2_resliced_trilin_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_ImpExpPain2_resliced_trilin_mask.mgh']);

system(['mri_vol2surf --mov ImpExpPain2_resliced_cubic_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_ImpExpPain2_resliced_cubic_mask.mgh']);

system(['mri_vol2surf --mov ImpExpPain2_resliced_nearest.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_ImpExpPain2_resliced_nearest.mgh']);

%% create STS * ImpExpPain1 mask
% ImpExpPain1
clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
Yo=double(Y(:,:,:,1).*Y(:,:,:,2));
vout=v(1);
vout.fname='STS-ImpExpPain1_mask.nii';
spm_write_vol(vout,Yo);

% map STS * ImpExpPain1 mask to surf (fsaverage)
system(['mri_vol2surf --mov STS-ImpExpPain1_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_STS-ImpExpPain1_mask.mgh']);

% ImpExpPain2
clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
Yo=double(Y(:,:,:,1).*Y(:,:,:,2));
vout=v(1);
vout.fname='STS-ImpExpPain2_mask.nii';
spm_write_vol(vout,Yo);

% map STS * ImpExpPain2 mask to surf (fsaverage)
system(['mri_vol2surf --mov STS-ImpExpPain2_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_STS-ImpExpPain2_mask.mgh']);

%% map betas of ImpPain1 and ExpPain1 in STS-ImpExpPain1 mask

% fslmaths brain.nii -mul 1.0 brain_float.nii

% reslice beta_ImpPain1
system(['mri_convert -rl brain_float.nii.gz beta_ImpPain1.nii beta_ImpPain1_resliced_trilin.nii']); % reslice trilinear
system(['mri_convert -rl brain_float.nii.gz beta_ExpPain1.nii beta_ExpPain1_resliced_trilin.nii']); % reslice trilinear

% vol > 0
% clear all;
% tmp = MRIread('beta_ImpPain1_resliced_trilin.nii');
% vol = tmp.vol;
% vol = single(vol>0);
% tmp.vol = vol;
% MRIwrite(tmp,'beta_ImpPain1_resliced_trilin_mask.nii','float');

% ImpPain1: masked_beta = resampled_beta.*resampled_mask;
clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
Yo=double(Y(:,:,:,1).*Y(:,:,:,2));
vout=v(1);
vout.fname='beta_ImpPain1_resliced_trilin_STS-ImpExpPain1_mask.nii';
spm_write_vol(vout,Yo);
% '/home/silashn/emp_calc/STS-ImpExp_mask/beta_ImpPain1_resliced_trilin.nii'
% '/home/silashn/emp_calc/STS-ImpExp_mask/STS-ImpExpPain1_mask.nii

% map betas * STS-ImpExpPain1 mask to surf (fsaverage)
system(['mri_vol2surf --mov beta_ImpPain1_resliced_trilin_STS-ImpExpPain1_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_beta_ImpPain1_resliced_trilin_STS-ImpExpPain1_mask.mgh']);

% ExpPain1: masked_beta = resampled_beta.*resampled_mask;
clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
Yo=double(Y(:,:,:,1).*Y(:,:,:,2));
vout=v(1);
vout.fname='beta_ExpPain1_resliced_trilin_STS-ImpExpPain1_mask.nii';
spm_write_vol(vout,Yo);
% '/home/silashn/emp_calc/STS-ImpExp_mask/beta_ImpPain2_resliced_trilin.nii'
% '/home/silashn/emp_calc/STS-ImpExp_mask/STS-ImpExpPain1_mask.nii

% map betas * STS-ImpExpPain1 mask to surf (fsaverage)
system(['mri_vol2surf --mov beta_ExpPain1_resliced_trilin_STS-ImpExpPain1_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_beta_ExpPain1_resliced_trilin_STS-ImpExpPain1_mask.mgh']);

%% map betas of ImpPain2 and ExpPain2 in STS-ImpExpPain2 mask

% fslmaths brain.nii -mul 1.0 brain_float.nii

% reslice beta_ImpPain2
system(['mri_convert -rl brain_float.nii.gz beta_ImpPain2.nii beta_ImpPain2_resliced_trilin.nii']); % reslice trilinear
system(['mri_convert -rl brain_float.nii.gz beta_ExpPain2.nii beta_ExpPain2_resliced_trilin.nii']); % reslice trilinear

% vol > 0
% clear all;
% tmp = MRIread('beta_ImpPain2_resliced_trilin.nii');
% vol = tmp.vol;
% vol = single(vol>0);
% tmp.vol = vol;
% MRIwrite(tmp,'beta_ImpPain2_resliced_trilin_mask.nii','float');

% ImpPain2: masked_beta = resampled_beta.*resampled_mask;
clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
Yo=double(Y(:,:,:,1).*Y(:,:,:,2));
vout=v(1);
vout.fname='beta_ImpPain2_resliced_trilin_STS-ImpExpPain2_mask.nii';
spm_write_vol(vout,Yo);
% '/home/silashn/emp_calc/STS-ImpExp_mask/beta_ImpPain2_resliced_trilin.nii'
% '/home/silashn/emp_calc/STS-ImpExp_mask/STS-ImpExpPain2_mask.nii

% map betas * STS-ImpExpPain2 mask to surf (fsaverage)
system(['mri_vol2surf --mov beta_ImpPain2_resliced_trilin_STS-ImpExpPain2_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_beta_ImpPain2_resliced_trilin_STS-ImpExpPain2_mask.mgh']);

% ExpPain2: masked_beta = resampled_beta.*resampled_mask;
clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
Yo=double(Y(:,:,:,1).*Y(:,:,:,2));
vout=v(1);
vout.fname='beta_ExpPain2_resliced_trilin_STS-ImpExpPain2_mask.nii';
spm_write_vol(vout,Yo);
% '/home/silashn/emp_calc/STS-ImpExp_mask/beta_ImpPain2_resliced_trilin.nii'
% '/home/silashn/emp_calc/STS-ImpExp_mask/STS-ImpExpPain2_mask.nii

% map betas * STS-ImpExpPain2 mask to surf (fsaverage)
system(['mri_vol2surf --mov beta_ExpPain2_resliced_trilin_STS-ImpExpPain2_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_beta_ExpPain2_resliced_trilin_STS-ImpExpPain2_mask.mgh']);

%% calc voxelwise correlation

% linear
clear all;
tmp1 = MRIread('beta_ImpPain1_resliced_trilin_STS-ImpExpPain1_mask.nii');
vol1 = tmp1.vol;
vol1 = vol1(vol1>0);
tmp1.vol1 = vol1;
MRIwrite(tmp1,'beta_pos_ImpPain1_masked.nii','float');

tmp2 = MRIread('beta_ExpPain1_resliced_trilin_STS-ImpExpPain1_mask.nii');
vol2 = tmp2.vol;
vol2 = vol2(vol2>0);
tmp2.vol2 = vol2;
MRIwrite(tmp2,'beta_pos_ExpPain1_masked.nii','float');

corr(vol1,vol2)
plot(vol1,vol2,'x')
vol12 = [vol1 vol2];
csvwrite('ImpPain1_ExpPain1_beta_pos_masked.csv',vol12);

%% non-linear
clear all;
tmp3 = MRIread('beta_ImpPain2_resliced_trilin_STS-ImpExpPain2_mask.nii');
vol3 = tmp3.vol;
vol3 = vol3(vol3>0);
tmp3.vol3 = vol3;
MRIwrite(tmp3,'beta_pos_ImpPain2_masked.nii','float');

tmp4 = MRIread('beta_ExpPain2_resliced_trilin_STS-ImpExpPain2_mask.nii');
vol4 = tmp4.vol;
vol4 = vol4(vol4>0);
tmp4.vol4 = vol4;
MRIwrite(tmp4,'beta_pos_ExpPain2_masked.nii','float');

corr(vol3,vol4)
plot(vol3,vol4,'x')
vol34 = [vol3 vol4];
csvwrite('ImpPain2_ExpPain2_beta_pos_masked.csv',vol34);

%% Not operations masks

system(['mri_convert -rl brain.nii ImpExpPain_Linear_Not_NonLinear.nii ImpExpPain_Linear_Not_NonLinear_resliced_trilin.nii']); % reslice trilinear
system(['mri_convert -rl brain.nii ImpExpPain_Nonlinear_Not_Linear.nii ImpExpPain_NonLinear_Not_linear_resliced_trilin.nii']); % reslice trilinear
system(['mri_convert -rl brain.nii ImpExpPain1_2.nii ImpExpPain1_2_resliced_trilin.nii']); % reslice trilinear

% vol > 0
clear all;
tmp = MRIread('ImpExpPain1_2_resliced_trilin.nii');
vol = tmp.vol;
vol = single(vol>0);
tmp.vol = vol;
MRIwrite(tmp,'ImpExpPain1_2_resliced_trilin_mask.nii','float');

clear all;
tmp = MRIread('ImpExpPain_NonLinear_Not_linear_resliced_trilin.nii');
vol = tmp.vol;
vol = single(vol>0);
tmp.vol = vol;
MRIwrite(tmp,'ImpExpPain_NonLinear_Not_linear_resliced_trilin_mask.nii','float');

clear all;
tmp = MRIread('ImpExpPain_Linear_Not_NonLinear_resliced_trilin.nii');
vol = tmp.vol;
vol = single(vol>0);
tmp.vol = vol;
MRIwrite(tmp,'ImpExpPain_Linear_Not_NonLinear_resliced_trilin_mask.nii','float');


%% create STS * Not operations mask
clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
Yo=double(Y(:,:,:,1).*Y(:,:,:,2));
vout=v(1);
vout.fname='STS-ImpExpPain_Linear_Not_NonLinear_resliced_trilin_mask.nii';
spm_write_vol(vout,Yo);

system(['mri_vol2surf --mov STS-ImpExpPain_Linear_Not_NonLinear_resliced_trilin_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_STS-ImpExpPain_Linear_Not_NonLinear_resliced_trilin_mask.mgh']);

clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
Yo=double(Y(:,:,:,1).*Y(:,:,:,2));
vout=v(1);
vout.fname='STS-ImpExpPain_NonLinear_Not_linear_resliced_trilin_mask.nii';
spm_write_vol(vout,Yo);

system(['mri_vol2surf --mov STS-ImpExpPain_NonLinear_Not_linear_resliced_trilin_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_STS-ImpExpPain_NonLinear_Not_linear_resliced_trilin_mask.mgh']);

clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
Yo=double(Y(:,:,:,1).*Y(:,:,:,2));
vout=v(1);
vout.fname='STS-ImpExpPain1_2_mask.nii';
spm_write_vol(vout,Yo);

system(['mri_vol2surf --mov STS-ImpExpPain1_2_mask.nii --reg brainregister.lta --projfrac 0.5 --interp nearest --hemi rh --o /home/silashn/emp_calc/STS-ImpExp_mask/fsavg_overlays/fsavg_STS-ImpExpPain1_2_mask.mgh']);

%%
STS-ImpExpPain_Linear_Not_NonLinear_resliced_trilin_mask.nii

STS-ImpExpPain_NonLinear_Not_linear_resliced_trilin_mask.nii

STS-ImpExpPain1_2_mask.nii


%% create STS * Not operations mask (after mapping to fsaverage)

clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
th=3.25789;
Yo=double(Y(:,:,:,1)&~Y(:,:,:,2));
vout=v(1);
vout.fname='/home/silashn/emp_calc/map_not_operations/new_fsavg_STS-ImpExpPain_Linear_Not_NonLinear_resliced_trilin_mask.mgh';
spm_write_vol(vout,Yo);

clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
th=3.25789;
Yo=double(Y(:,:,:,1)&~Y(:,:,:,2));
vout=v(1);
vout.fname='/home/silashn/emp_calc/map_not_operations/new_fsavg_STS-ImpExpPain_NonLinear_Not_linear_resliced_trilin_mask.mgh';
spm_write_vol(vout,Yo);

clear all;
fn=spm_select
v=spm_vol(fn);
Y=spm_read_vols(v);
th=3.25789;
Yo=double(Y(:,:,:,1)&Y(:,:,:,2));
vout=v(1);
vout.fname='/home/silashn/emp_calc/map_not_operations/new_fsavg_STS-ImpExpPain1_2_mask.mgh';
spm_write_vol(vout,Yo);


## /map_operations/finalscript
%% create ImpExpPain1 STS masked vol

% reslice vol label ImpExpPain1
system(['mri_convert -rt nearest -rl ../brain_float.nii.gz th_ImpPain1_and_ExpPain1.nii th_ImpPain1_and_ExpPain1_rl-nearest.nii']); % reslice nearest

%% mask STS linear
clear all;
V1=spm_vol('th_ImpPain1_and_ExpPain1_rl-nearest.nii');
V2=spm_vol('rctx_rh_S_temporal_sup_resliced_trilin_mask.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1.nii';
spm_write_vol(vout,Yo);

% rctx_rh_S_temporal_sup_resliced_trilin_mask_MASKED2.nii
clear all;
V1=spm_vol('th_ImpPain1_and_ExpPain1_rl-nearest.nii');
V2=spm_vol('rctx_rh_S_temporal_sup_resliced_trilin_mask_MASKED2.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED2.nii';
spm_write_vol(vout,Yo);

% MASKED3
clear all;
V1=spm_vol('th_ImpPain1_and_ExpPain1_rl-nearest.nii');
V2=spm_vol('rctx_rh_S_temporal_sup_resliced_trilin_mask_MASKED3.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED3.nii';
spm_write_vol(vout,Yo);

% MASKED4
clear all;
V1=spm_vol('th_ImpPain1_and_ExpPain1_rl-nearest.nii');
V2=spm_vol('rctx_rh_S_temporal_sup_resliced_trilin_mask_MASKED4.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED4.nii';
spm_write_vol(vout,Yo);

%% mask STS non-linear

% reslice vol label ImpExpPain1
system(['mri_convert -rt nearest -rl ../brain_float.nii.gz th_ImpPain2_and_ExpPain2.nii th_ImpPain2_and_ExpPain2_rl-nearest.nii']); % reslice nearest

% mask STS
clear all;
V1=spm_vol('th_ImpPain2_and_ExpPain2_rl-nearest.nii');
V2=spm_vol('rctx_rh_S_temporal_sup_resliced_trilin_mask.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2.nii';
spm_write_vol(vout,Yo);

% 2
clear all;
V1=spm_vol('th_ImpPain2_and_ExpPain2_rl-nearest.nii');
V2=spm_vol('rctx_rh_S_temporal_sup_resliced_trilin_mask_MASKED2.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED2.nii';
spm_write_vol(vout,Yo);

% 3
clear all;
V1=spm_vol('th_ImpPain2_and_ExpPain2_rl-nearest.nii');
V2=spm_vol('rctx_rh_S_temporal_sup_resliced_trilin_mask_MASKED3.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED3.nii';
spm_write_vol(vout,Yo);

% 4
clear all;
V1=spm_vol('th_ImpPain2_and_ExpPain2_rl-nearest.nii');
V2=spm_vol('rctx_rh_S_temporal_sup_resliced_trilin_mask_MASKED4.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED4.nii';
spm_write_vol(vout,Yo);

%% thresholding (wrong step!!!)

% threshold above 0 (remove NaNs)
clear all;
V=spm_vol('beta_ImpPain1.nii');
Y=spm_read_vols(V);
th=0;
Yo=Y(:,:,:)>th;
vout=V(1);
vout.fname='beta_th_ImpPain1.nii';
spm_write_vol(vout,Yo);

clear all;
V=spm_vol('beta_ImpPain2.nii');
Y=spm_read_vols(V);
th=0;
Yo=Y(:,:,:)>th;
vout=V(1);
vout.fname='beta_th_ImpPain2.nii';
spm_write_vol(vout,Yo);

clear all;
V=spm_vol('beta_ExpPain1.nii');
Y=spm_read_vols(V);
th=0;
Yo=Y(:,:,:)>th;
vout=V(1);
vout.fname='beta_th_ExpPain1.nii';
spm_write_vol(vout,Yo);

clear all;
V=spm_vol('beta_ExpPain2.nii');
Y=spm_read_vols(V);
th=0;
Yo=Y(:,:,:)>th;
vout=V(1);
vout.fname='beta_th_ExpPain2.nii';
spm_write_vol(vout,Yo);

%% ImpPain1

% reslice betas
system(['mri_convert -rl ../brain_float.nii.gz beta_ImpPain1.nii beta_ImpPain1_rl-trilin.nii']); % reslice trilinear

% mask betas
clear all;
V1=spm_vol('beta_ImpPain1_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ImpPain1_masked_STS-ImpExp1.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ImpPain1_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED2.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ImpPain1_masked_STS-ImpExp1_MASKED2.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ImpPain1_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED3.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ImpPain1_masked_STS-ImpExp1_MASKED3.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ImpPain1_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED4.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ImpPain1_masked_STS-ImpExp1_MASKED4.nii';
spm_write_vol(vout,Yo);

%% ExpPain1

% reslice betas
system(['mri_convert -rl ../brain_float.nii.gz beta_ExpPain1.nii beta_ExpPain1_rl-trilin.nii']); % reslice trilinear

% mask betas
clear all;
V1=spm_vol('beta_ExpPain1_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ExpPain1_masked_STS-ImpExp1.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ExpPain1_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ExpPain1_masked_STS-ImpExp1.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ExpPain1_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED2.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ExpPain1_masked_STS-ImpExp1_MASKED2.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ExpPain1_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED3.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ExpPain1_masked_STS-ImpExp1_MASKED3.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ExpPain1_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED4.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ExpPain1_masked_STS-ImpExp1_MASKED4.nii';
spm_write_vol(vout,Yo);

%% ImpPain2

system(['mri_convert -rl ../brain_float.nii.gz beta_ImpPain2.nii beta_ImpPain2_rl-trilin.nii']); % reslice trilinear

% mask betas
clear all;
V1=spm_vol('beta_ImpPain2_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ImpPain2_masked_STS-ImpExp2.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ImpPain2_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED2.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ImpPain2_masked_STS-ImpExp2_MASKED2.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ImpPain2_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED3.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ImpPain2_masked_STS-ImpExp2_MASKED3.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ImpPain2_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED4.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ImpPain2_masked_STS-ImpExp2_MASKED4.nii';
spm_write_vol(vout,Yo);

%% ExpPain2

system(['mri_convert -rl ../brain_float.nii.gz beta_ExpPain2.nii beta_ExpPain2_rl-trilin.nii']); % reslice trilinear

% mask betas
clear all;
V1=spm_vol('beta_ExpPain2_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ExpPain2_masked_STS-ImpExp2.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ExpPain2_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED2.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ExpPain2_masked_STS-ImpExp2_MASKED2.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ExpPain2_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED3.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ExpPain2_masked_STS-ImpExp2_MASKED3.nii';
spm_write_vol(vout,Yo);

clear all;
V1=spm_vol('beta_ExpPain2_rl-trilin.nii');
V2=spm_vol('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED4.nii');
Y1=spm_read_vols(V1);
Y2=spm_read_vols(V2);
Yo=double(Y1(:,:,:).*Y2(:,:,:));
vout=V1(1);
vout.fname='beta_ExpPain2_masked_STS-ImpExp2_MASKED4.nii';
spm_write_vol(vout,Yo);

%% Extract raw beta values from ROI's (STS -> ImpExp1 and ImpExp2)

%% ImpPain1

% full
clear all;
tmp_mask_ImpPain1 = MRIread('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1.nii');
tmp_ImpPain1 = MRIread('beta_ImpPain1_masked_STS-ImpExp1.nii');
vol_ImpPain1 = tmp_ImpPain1.vol;
vol_mask_ImpPain1 = tmp_mask_ImpPain1.vol;
vol_mask_ImpPain1 = vol_ImpPain1(vol_mask_ImpPain1>0);
tmp1.vol_ImpPain1 = vol_mask_ImpPain1;
MRIwrite(tmp_ImpPain1,'beta_pos_ImpPain1_masked_STS-ImpExp1.nii','float');
csvwrite('beta_pos_ImpPain1_masked_STS_ImpExp1.csv',vol_mask_ImpPain1)

% m2
clear all;
tmp_mask_ImpPain1 = MRIread('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED2.nii');
tmp_ImpPain1 = MRIread('beta_ImpPain1_masked_STS-ImpExp1_MASKED2.nii');
vol_ImpPain1 = tmp_ImpPain1.vol;
vol_mask_ImpPain1 = tmp_mask_ImpPain1.vol;
vol_mask_ImpPain1 = vol_ImpPain1(vol_mask_ImpPain1>0);
tmp1.vol_ImpPain1 = vol_mask_ImpPain1;
MRIwrite(tmp_ImpPain1,'beta_pos_ImpPain1_masked_STS-ImpExp1_MASKED2.nii','float');
csvwrite('beta_pos_ImpPain1_masked_STS_ImpExp1_MASKED2.csv',vol_mask_ImpPain1)

% m3
clear all;
tmp_mask_ImpPain1 = MRIread('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED3.nii');
tmp_ImpPain1 = MRIread('beta_ImpPain1_masked_STS-ImpExp1_MASKED3.nii');
vol_ImpPain1 = tmp_ImpPain1.vol;
vol_mask_ImpPain1 = tmp_mask_ImpPain1.vol;
vol_mask_ImpPain1 = vol_ImpPain1(vol_mask_ImpPain1>0);
tmp1.vol_ImpPain1 = vol_mask_ImpPain1;
MRIwrite(tmp_ImpPain1,'beta_pos_ImpPain1_masked_STS-ImpExp1_MASKED3.nii','float');
csvwrite('beta_pos_ImpPain1_masked_STS_ImpExp1_MASKED3.csv',vol_mask_ImpPain1)

% m4
clear all;
tmp_mask_ImpPain1 = MRIread('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED4.nii');
tmp_ImpPain1 = MRIread('beta_ImpPain1_masked_STS-ImpExp1_MASKED4.nii');
vol_ImpPain1 = tmp_ImpPain1.vol;
vol_mask_ImpPain1 = tmp_mask_ImpPain1.vol;
vol_mask_ImpPain1 = vol_ImpPain1(vol_mask_ImpPain1>0);
tmp1.vol_ImpPain1 = vol_mask_ImpPain1;
MRIwrite(tmp_ImpPain1,'beta_pos_ImpPain1_masked_STS-ImpExp1_MASKED4.nii','float');
csvwrite('beta_pos_ImpPain1_masked_STS_ImpExp1_MASKED4.csv',vol_mask_ImpPain1)

%% ExpPain1

% full
clear all;
tmp_mask_ExpPain1 = MRIread('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1.nii');
tmp_ExpPain1 = MRIread('beta_ExpPain1_masked_STS-ImpExp1.nii');
vol_ExpPain1 = tmp_ExpPain1.vol;
vol_mask_ExpPain1 = tmp_mask_ExpPain1.vol;
vol_mask_ExpPain1 = vol_ExpPain1(vol_mask_ExpPain1>0);
tmp1.vol_ExpPain1 = vol_mask_ExpPain1;
MRIwrite(tmp_ExpPain1,'beta_pos_ExpPain1_masked_STS-ImpExp1.nii','float');
csvwrite('beta_pos_ExpPain1_masked_STS_ImpExp1.csv',vol_mask_ExpPain1)

% m2
clear all;
tmp_mask_ExpPain1 = MRIread('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED2.nii');
tmp_ExpPain1 = MRIread('beta_ExpPain1_masked_STS-ImpExp1_MASKED2.nii');
vol_ExpPain1 = tmp_ExpPain1.vol;
vol_mask_ExpPain1 = tmp_mask_ExpPain1.vol;
vol_mask_ExpPain1 = vol_ExpPain1(vol_mask_ExpPain1>0);
tmp1.vol_ExpPain1 = vol_mask_ExpPain1;
MRIwrite(tmp_ExpPain1,'beta_pos_ExpPain1_masked_STS-ImpExp1_MASKED2.nii','float');
csvwrite('beta_pos_ExpPain1_masked_STS_ImpExp1_MASKED2.csv',vol_mask_ExpPain1)

% m3
clear all;
tmp_mask_ExpPain1 = MRIread('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED3.nii');
tmp_ExpPain1 = MRIread('beta_ExpPain1_masked_STS-ImpExp1_MASKED3.nii');
vol_ExpPain1 = tmp_ExpPain1.vol;
vol_mask_ExpPain1 = tmp_mask_ExpPain1.vol;
vol_mask_ExpPain1 = vol_ExpPain1(vol_mask_ExpPain1>0);
tmp1.vol_ExpPain1 = vol_mask_ExpPain1;
MRIwrite(tmp_ExpPain1,'beta_pos_ExpPain1_masked_STS-ImpExp1_MASKED3.nii','float');
csvwrite('beta_pos_ExpPain1_masked_STS_ImpExp1_MASKED3.csv',vol_mask_ExpPain1)

% m4
clear all;
tmp_mask_ExpPain1 = MRIread('th_rl-nearest_masked-STS_ImpPain1_and_ExpPain1_MASKED4.nii');
tmp_ExpPain1 = MRIread('beta_ExpPain1_masked_STS-ImpExp1_MASKED4.nii');
vol_ExpPain1 = tmp_ExpPain1.vol;
vol_mask_ExpPain1 = tmp_mask_ExpPain1.vol;
vol_mask_ExpPain1 = vol_ExpPain1(vol_mask_ExpPain1>0);
tmp1.vol_ExpPain1 = vol_mask_ExpPain1;
MRIwrite(tmp_ExpPain1,'beta_pos_ExpPain1_masked_STS-ImpExp1_MASKED4.nii','float');
csvwrite('beta_pos_ExpPain1_masked_STS_ImpExp1_MASKED4.csv',vol_mask_ExpPain1)

%% ImpPain2

% full
clear all;
tmp_mask_ImpPain2 = MRIread('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2.nii');
tmp_ImpPain2 = MRIread('beta_ImpPain2_masked_STS-ImpExp2.nii');
vol_ImpPain2 = tmp_ImpPain2.vol;
vol_mask_ImpPain2 = tmp_mask_ImpPain2.vol;
vol_mask_ImpPain2 = vol_ImpPain2(vol_mask_ImpPain2>0);
tmp2.vol_ImpPain2 = vol_mask_ImpPain2;
MRIwrite(tmp_ImpPain2,'beta_pos_ImpPain2_masked_STS-ImpExp2.nii','float');
csvwrite('beta_pos_ImpPain2_masked_STS_ImpExp2.csv',vol_mask_ImpPain2)

% m2
clear all;
tmp_mask_ImpPain2 = MRIread('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED2.nii');
tmp_ImpPain2 = MRIread('beta_ImpPain2_masked_STS-ImpExp2_MASKED2.nii');
vol_ImpPain2 = tmp_ImpPain2.vol;
vol_mask_ImpPain2 = tmp_mask_ImpPain2.vol;
vol_mask_ImpPain2 = vol_ImpPain2(vol_mask_ImpPain2>0);
tmp2.vol_ImpPain2 = vol_mask_ImpPain2;
MRIwrite(tmp_ImpPain2,'beta_pos_ImpPain2_masked_STS-ImpExp2_MASKED2.nii','float');
csvwrite('beta_pos_ImpPain2_masked_STS_ImpExp2_MASKED2.csv',vol_mask_ImpPain2)

% m3
clear all;
tmp_mask_ImpPain2 = MRIread('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED3.nii');
tmp_ImpPain2 = MRIread('beta_ImpPain2_masked_STS-ImpExp2_MASKED3.nii');
vol_ImpPain2 = tmp_ImpPain2.vol;
vol_mask_ImpPain2 = tmp_mask_ImpPain2.vol;
vol_mask_ImpPain2 = vol_ImpPain2(vol_mask_ImpPain2>0);
tmp2.vol_ImpPain2 = vol_mask_ImpPain2;
MRIwrite(tmp_ImpPain2,'beta_pos_ImpPain2_masked_STS-ImpExp2_MASKED3.nii','float');
csvwrite('beta_pos_ImpPain2_masked_STS_ImpExp2_MASKED3.csv',vol_mask_ImpPain2)

% m4
clear all;
tmp_mask_ImpPain2 = MRIread('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED4.nii');
tmp_ImpPain2 = MRIread('beta_ImpPain2_masked_STS-ImpExp2_MASKED4.nii');
vol_ImpPain2 = tmp_ImpPain2.vol;
vol_mask_ImpPain2 = tmp_mask_ImpPain2.vol;
vol_mask_ImpPain2 = vol_ImpPain2(vol_mask_ImpPain2>0);
tmp2.vol_ImpPain2 = vol_mask_ImpPain2;
MRIwrite(tmp_ImpPain2,'beta_pos_ImpPain2_masked_STS-ImpExp2_MASKED4.nii','float');
csvwrite('beta_pos_ImpPain2_masked_STS_ImpExp2_MASKED4.csv',vol_mask_ImpPain2)

%% ExpPain2

% full
clear all;
tmp_mask_ExpPain2 = MRIread('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2.nii');
tmp_ExpPain2 = MRIread('beta_ExpPain2_masked_STS-ImpExp2.nii');
vol_ExpPain2 = tmp_ExpPain2.vol;
vol_mask_ExpPain2 = tmp_mask_ExpPain2.vol;
vol_mask_ExpPain2 = vol_ExpPain2(vol_mask_ExpPain2>0);
tmp2.vol_ExpPain2 = vol_mask_ExpPain2;
MRIwrite(tmp_ExpPain2,'beta_pos_ExpPain2_masked_STS-ImpExp2.nii','float');
csvwrite('beta_pos_ExpPain2_masked_STS_ImpExp2.csv',vol_mask_ExpPain2)

% m2
clear all;
tmp_mask_ExpPain2 = MRIread('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED2.nii');
tmp_ExpPain2 = MRIread('beta_ExpPain2_masked_STS-ImpExp2_MASKED2.nii');
vol_ExpPain2 = tmp_ExpPain2.vol;
vol_mask_ExpPain2 = tmp_mask_ExpPain2.vol;
vol_mask_ExpPain2 = vol_ExpPain2(vol_mask_ExpPain2>0);
tmp2.vol_ExpPain2 = vol_mask_ExpPain2;
MRIwrite(tmp_ExpPain2,'beta_pos_ExpPain2_masked_STS-ImpExp2_MASKED2.nii','float');
csvwrite('beta_pos_ExpPain2_masked_STS_ImpExp2_MASKED2.csv',vol_mask_ExpPain2)

% m3
clear all;
tmp_mask_ExpPain2 = MRIread('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED3.nii');
tmp_ExpPain2 = MRIread('beta_ExpPain2_masked_STS-ImpExp2_MASKED3.nii');
vol_ExpPain2 = tmp_ExpPain2.vol;
vol_mask_ExpPain2 = tmp_mask_ExpPain2.vol;
vol_mask_ExpPain2 = vol_ExpPain2(vol_mask_ExpPain2>0);
tmp2.vol_ExpPain2 = vol_mask_ExpPain2;
MRIwrite(tmp_ExpPain2,'beta_pos_ExpPain2_masked_STS-ImpExp2_MASKED3.nii','float');
csvwrite('beta_pos_ExpPain2_masked_STS_ImpExp2_MASKED3.csv',vol_mask_ExpPain2)

% m4
clear all;
tmp_mask_ExpPain2 = MRIread('th_rl-nearest_masked-STS_ImpPain2_and_ExpPain2_MASKED4.nii');
tmp_ExpPain2 = MRIread('beta_ExpPain2_masked_STS-ImpExp2_MASKED4.nii');
vol_ExpPain2 = tmp_ExpPain2.vol;
vol_mask_ExpPain2 = tmp_mask_ExpPain2.vol;
vol_mask_ExpPain2 = vol_ExpPain2(vol_mask_ExpPain2>0);
tmp2.vol_ExpPain2 = vol_mask_ExpPain2;
MRIwrite(tmp_ExpPain2,'beta_pos_ExpPain2_masked_STS-ImpExp2_MASKED4.nii','float');
csvwrite('beta_pos_ExpPain2_masked_STS_ImpExp2_MASKED4.csv',vol_mask_ExpPain2)


%% create output files for JASP - ImpPain2, ExpPain2, ImpPain1, ExpPain1

%%

m1_ImpPain1 = csvread('beta_pos_ImpPain1_masked_STS_ImpExp1.csv');
m1_ExpPain1 = csvread('beta_pos_ExpPain1_masked_STS_ImpExp1.csv');
m1_ImpPain2 = csvread('beta_pos_ImpPain2_masked_STS_ImpExp2.csv');
m1_ExpPain2 = csvread('beta_pos_ExpPain2_masked_STS_ImpExp2.csv');

% masked2
%load beta_pos_ImpPain1_masked_STS_ImpExp1_MASKED2.csv
%load beta_pos_ExpPain1_masked_STS_ImpExp1_MASKED2.csv
%load beta_pos_ImpPain2_masked_STS_ImpExp2_MASKED2.csv
%load beta_pos_ExpPain2_masked_STS_ImpExp2_MASKED2.csv

m2_ImpPain1 = csvread('beta_pos_ImpPain1_masked_STS_ImpExp1_MASKED2.csv');
m2_ExpPain1 = csvread('beta_pos_ExpPain1_masked_STS_ImpExp1_MASKED2.csv');
m2_ImpPain2 = csvread('beta_pos_ImpPain2_masked_STS_ImpExp2_MASKED2.csv');
m2_ExpPain2 = csvread('beta_pos_ExpPain2_masked_STS_ImpExp2_MASKED2.csv');

% masked3

m3_ImpPain1 = csvread('beta_pos_ImpPain1_masked_STS_ImpExp1_MASKED3.csv');
m3_ExpPain1 = csvread('beta_pos_ExpPain1_masked_STS_ImpExp1_MASKED3.csv');
m3_ImpPain2 = csvread('beta_pos_ImpPain2_masked_STS_ImpExp2_MASKED3.csv');
m3_ExpPain2 = csvread('beta_pos_ExpPain2_masked_STS_ImpExp2_MASKED3.csv');

% masked4

m4_ImpPain1 = csvread('beta_pos_ImpPain1_masked_STS_ImpExp1_MASKED4.csv');
m4_ExpPain1 = csvread('beta_pos_ExpPain1_masked_STS_ImpExp1_MASKED4.csv');
m4_ImpPain2 = csvread('beta_pos_ImpPain2_masked_STS_ImpExp2_MASKED4.csv');
m4_ExpPain2 = csvread('beta_pos_ExpPain2_masked_STS_ImpExp2_MASKED4.csv');

% write file
%%
%output_masked = [m1_ImpPain1,m1_ExpPain1,m1_ImpPain2,m1_ExpPain2,m2_ImpPain1,m2_ExpPain1,m2_ImpPain2,m2_ExpPain2,m3_ImpPain1,m3_ExpPain2,m3_ImpPain2,m3_ExpPain2,m4_ImpPain1,m4_ExpPain1,m4_ImpPain2,m4_ExpPain2];

m1_ImpExp1=[m1_ImpPain1,m1_ExpPain1];
csvwrite('m1_ImpExp1.csv', m1_ImpExp1);

m1_ImpExp2=[m1_ImpPain2,m1_ExpPain2];
csvwrite('m1_ImpExp2.csv', m1_ImpExp2);

m2_ImpExp1=[m2_ImpPain1,m2_ExpPain1];
csvwrite('m2_ImpExp1.csv', m2_ImpExp1);

m2_ImpExp2=[m2_ImpPain2,m2_ExpPain2];
csvwrite('m2_ImpExp2.csv', m2_ImpExp2);

m3_ImpExp1=[m3_ImpPain1,m3_ExpPain1];
csvwrite('m3_ImpExp1.csv', m3_ImpExp1);

m3_ImpExp2=[m3_ImpPain2,m3_ExpPain2];
csvwrite('m3_ImpExp2.csv', m3_ImpExp2);

m4_ImpExp1=[m4_ImpPain1,m4_ExpPain1];
csvwrite('m4_ImpExp1.csv', m4_ImpExp1);

m4_ImpExp2=[m4_ImpPain2,m4_ExpPain2];
csvwrite('m4_ImpExp2.csv', m4_ImpExp2);

%%
csvwrite(PPP_allcsv, output_masked);
